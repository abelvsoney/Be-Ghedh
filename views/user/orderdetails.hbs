<!DOCTYPE html>
<html lang="en">
<head>
	<title>Shoping Cart</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.png"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/linearicons-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->
<script src="https://cdn.jsdelivr.net/npm/easyinvoice/dist/easyinvoice.min.js"></script>
</head>
<body class="animsition">


	<center><h3 class="mt-5 pt-5" style="text-decoration: underline;">Order Details</h3></center>

	<!-- Shoping Cart -->
    
	<form class="bg0 p-t-75 p-b-85">
		<div class="container">
			<div class="row">
				<div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
					<div class="m-l-25 m-r--38 m-lr-0-xl">
						<div class="wrap-table-shopping-cart">
							<table class="table-shopping-cart">
								<tr class="table_head">
									<th class="column-1">Product</th>
									<th class="column-2"></th>
									<th class="column-3">Price</th>
									<th class="column-5">Quantity</th>
								</tr>
                                {{#each products}}
								<tr class="table_row">
									<td class="column-1">
										<div class="how-itemcart-nodesign">
												<img src="ImageSite/{{this.product._id}}1.png" alt="IMG">
										</div>
									</td>
									<td class="column-2" id="pname">{{this.product.product_name}}</td>
									<td class="column-3" id="pprice">$ {{this.product.offerprice}}</td>
									<td class="column-5">
										<div class="wrap-num-productnoborder flex-w m-l-auto m-r-0">
											<div class="btn-num-product-down"></div>
											<div class="btn-num-product-down"></div>
											{{!-- <input class="mtext-104 cl3 txt-center num-product" type="number"
												name="num-product1" value={{this.quantity}}> --}}
											<span class="mtext-104 cl3 pt-2 txt-center num-product-noborder"
												id="pquantity">{{this.quantity}}</span>

											<div class="btn-num-product-down"></div>

										</div>
									</td>
								</tr>
                                {{/each}}

							</table>
						</div>
					</div>
				</div>
                
                <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
                    <div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
                
                        <div class="flex-w flex-t p-t-27 p-b-33">
                            <div class="size-208">
                                <span class="mtext-101 cl2">
                                    Order Id:
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span class="mtext-10 cl2" id="carttotal">
                                    {{orderDetails._id}}
                                </span>
                            </div>
                            <div class="size-208">
                                <span class="mtext-101 cl2">
                                    Status:
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span class="mtext-10 cl2" id="carttotal">
                                    {{orderDetails.status}}
                                </span>
                            </div>
                        </div>
                        <h4 class="mtext-109 cl2 p-b-30">
                            Cart Totals
                        </h4>
                        <div class="flex-w flex-t p-t-27 p-b-33">
                            <div class="size-208">
                                <span class="mtext-101 cl2">
                                    Total:
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span>$ </span>
                                <span class="mtext-110 cl2" id="orgprice">
                                    {{orderDetails.orgPrice}}
                                </span>
                            </div>
                            <div class="size-208">
                                <span class="mtext-101 cl2">
                                    Offer:
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span>- </span>
                                <span class="mtext-110 cl2" id="offertotal">
                                    {{orderDetails.offertotal}}
                                </span>
                            </div>
                            <div class="size-208">
                                <span class="mtext-101 cl2">
                                    Coupon:
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span>- </span>
                                <span class="mtext-110 cl2" id="coupDisc">
                                    {{orderDetails.coupDisc}}
                                </span>
                            </div>
                            <div class="size-208">
                                <span class="mtext-101 cl2">
                                    Sub Total:
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span>$ </span>
                                <span class="mtext-110 cl2" id="total">
                                    {{orderDetails.totalAmount}}
                                </span>
                            </div>
                        </div>

                        <h4 class="mtext-109 cl2 p-b-30">
                            Address
                        </h4>
                        <div class="flex-w flex-t p-t-27 p-b-33">
                
                            <div class="size-209 p-t-1">
                                <span class="mtext-110 cl2" id="orgprice" style="font-weight: bold;">
                                    {{orderDetails.addressId.firstname}} {{orderDetails.addressId.secondname}}
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span class="mtext-110 cl2" id="offertotal">
                                    {{orderDetails.addressId.address}},
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span class="mtext-110 cl2" id="coupDisc">
                                    {{orderDetails.addressId.city}}, {{orderDetails.addressId.state}}
                                </span>
                            </div>
                
                            <div class="size-209 p-t-1">
                                <span class="mtext-110 cl2" id="total">
                                    {{orderDetails.addressId.pincode}}
                                </span>
                            </div>
                            <div class="size-209 p-t-1">
                                <span class="mtext-110 cl2" id="total">
                                    Ph No: {{orderDetails.addressId.number}}
                                </span>
                            </div>
                        </div>
						<button class="btn btn-primary" onclick="downloadInvoice()" >
							Download Invoice
						</button>
                    </div>
                </div>
			</div>
		</div>
	</form>
    <div id="orderDetails" hidden>
        {{orderDetails}}
    </div>

    
		
	
		

	<!-- Back to top -->
	<div class="btn-back-to-top" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="zmdi zmdi-chevron-up"></i>
		</span>
	</div>

<script>
	async function downloadInvoice() {
        let d = document.getElementById("total").innerHTML
		event.preventDefault();
		console.log(d)
		var data = {
    // Customize enables you to provide your own templates
    // Please review the documentation for instructions and examples
    "customize": {
        //  "template": fs.readFileSync('template.html', 'base64') // Must be base64 encoded html 
    },
    // Your own data
    "sender": {
        "company": "Be-Ghedh",
        "address": "Lorem Ipsum",
        "zip": "1234 AB",
        "city": "Sampletown",
        "country": "Samplecountry"
    },
    // Your recipient
   // "client": {
       // "company": "Client Corp",
       // "address": "Clientstreet 456",
       // "zip": "4567 CD",
        //"city": "Clientcity",
        //"country": "Clientcountry"
        // "custom1": "custom value 1",
        // "custom2": "custom value 2",
        // "custom3": "custom value 3"
   // },
    "information": {
        // Invoice number
        //"number": "2021.0001",
        // Invoice data
        "date": "12-12-2021",
        // Invoice due date
        //"due-date": "31-12-2021"
    },
    // The products you would like to see on your invoice
    // Total values are being calculated automatically
    "products": [
        {
            "quantity": 2,
            "description": "Product 1",
            "tax-rate": 6,
            "price": 33.87
        },
        {
            "quantity": 4.1,
            "description": "Product 2",
            "tax-rate": 6,
            "price": 12.34
        },
        {
            "quantity": 4.5678,
            "description": "Product 3",
            "tax-rate": 21,
            "price": 6324.453456
        }
    ],
    // The message you would like to display on the bottom of your invoice
    "bottom-notice": "Kindly pay your invoice within 15 days.",
    // Settings to customize your invoice
    "settings": {
        "currency": "USD", // See documentation 'Locales and Currency' for more info. Leave empty for no currency.
        // "locale": "nl-NL", // Defaults to en-US, used for number formatting (See documentation 'Locales and Currency')
        // "tax-notation": "gst", // Defaults to 'vat'
        // "margin-top": 25, // Defaults to '25'
        // "margin-right": 25, // Defaults to '25'
        // "margin-left": 25, // Defaults to '25'
        // "margin-bottom": 25, // Defaults to '25'
        // "format": "A4", // Defaults to A4, options: A3, A4, A5, Legal, Letter, Tabloid
        // "height": "1000px", // allowed units: mm, cm, in, px
        // "width": "500px", // allowed units: mm, cm, in, px
        // "orientation": "landscape", // portrait or landscape, defaults to portrait
    },
    // Translate your invoice to your preferred language
    "translate": {
        // "invoice": "FACTUUR",  // Default to 'INVOICE'
        // "number": "Nummer", // Defaults to 'Number'
        // "date": "Datum", // Default to 'Date'
        // "due-date": "Verloopdatum", // Defaults to 'Due Date'
        // "subtotal": "Subtotaal", // Defaults to 'Subtotal'
        // "products": "Producten", // Defaults to 'Products'
        // "quantity": "Aantal", // Default to 'Quantity'
        // "price": "Prijs", // Defaults to 'Price'
        // "product-total": "Totaal", // Defaults to 'Total'
        // "total": "Totaal" // Defaults to 'Total'
    },
	};
	await easyinvoice.createInvoice(data, async function (result) {
        // The response will contain a base64 encoded PDF file
        console.log('PDF base64 string: ', result.pdf);
		await easyinvoice.download("invoice.pdf")
	});
	}
</script>
	
<script>
		function changeQuantity(cartId, proId, count) {
			let quantity = parseInt(document.getElementById(proId).innerHTML)
			count = parseInt(count)

			$.ajax({
				url:'/changeproductquantity',
				data:{
					cart: cartId,
					product: proId,
					count: count,
					quantity: quantity
				}, 
				method:'post',
				success:(response) => {
					if(response.status) {
						document.getElementById(proId).innerHTML = quantity + count
						document.getElementById("total").innerHTML = response.total
					} else if (response.removeProduct) {
						alert("Product removed from cart")
						location.reload()
					}
				}
			})
		}
	</script>
</body>
</html>